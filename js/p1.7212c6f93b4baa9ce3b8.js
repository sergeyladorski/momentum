(()=>{"use strict";const e=["time","date","greeting","quote","weather","audio","todolist"],t={city:"Minsk",name:"",language:"en",photoSource:"github",bgQuery:"",queryInputError:"",blocks:e},n=document.querySelector(".quote"),o=document.querySelector(".author"),a=document.querySelector(".change-quote");let r,u=[];async function c(){let e="";e="en"===t.language?"./data/quotesEn.json":"./data/quotesRu.json";const n=await fetch(e,{headers:{"Content-Type":"application/json",Accept:"application/json"}}),o=await n.json();u=o,i()}function i(){r=Math.floor(Math.random()*u.length);const e=u[r];n.textContent=`«${e.text}»`,o.textContent=null===e.author?"Unknown author":e.author}const l=[{title:"Aqua Caelestis",src:"./assets/sounds/AquaCaelestis.mp3",duration:"00:39"},{title:"Ennio Morricone",src:"./assets/sounds/EnnioMorricone.mp3",duration:"01:37"},{title:"River Flows In You",src:"./assets/sounds/RiverFlowsInYou.mp3",duration:"01:37"},{title:"Summer Wind",src:"./assets/sounds/SummerWind.mp3",duration:"01:50"}],s=document.querySelector(".play-list"),d=document.querySelector(".play"),g=document.querySelector(".play-prev"),m=document.querySelector(".play-next"),p=document.querySelector(".play-volume"),y=document.querySelector(".currently-played"),h=document.querySelector(".volume-bar"),f=document.querySelector(".progress-bar"),v=document.querySelector(".player__time_current"),S=document.querySelector(".player__time_duration"),b=new Audio;y.textContent=l[0].title,S.textContent=l[0].duration;let q=!1,_=0,L=100;l.forEach((e=>{const t=document.createElement("li");t.classList.add("play-list__item"),t.textContent=e.title,s.append(t)}));const w=document.querySelectorAll(".play-list__item");function E(){b.src=l[_].src,b.currentTime=f.value,b.play(),function(){for(let e=0;e<w.length;e++)e===_?(w[e].classList.add("item-active"),y.textContent=w[e].textContent):w[e].classList.remove("item-active")}(),I(),v.textContent=b.currentTime,y.classList.add("currently-played_animated"),b.addEventListener("ended",$)}function k(){d.classList.contains("pause")||(d.classList.add("pause"),q=!q)}function $(){b.currentTime=0,C()}function C(){f.value=0,_===l.length-1?_=0:_++,E(),k()}function x(e){return`${Math.floor(e/60)}`.padStart(2,"0")}function A(e){return`${Math.floor(e%60)}`.padStart(2,"0")}function M(){const e=b.currentTime;f.value=`${Math.round(e)}`,v.textContent=`${x(e)}:${A(e)}`}function I(){M(),setTimeout(I,1e3)}function Q(){b.volume=h.value/100}p.addEventListener("click",(function(){!1===b.muted?(b.muted=!0,h.value=0):(b.muted=!1,h.value=L,Q()),p.classList.toggle("play-volume_off")})),h.addEventListener("change",(function(){b.muted=!1,L=h.value,Q(),p.classList.remove("play-volume_off")})),f.addEventListener("change",(function(){b.currentTime=f.value})),b.addEventListener("loadedmetadata",(()=>{M(),function(){const e=b.duration;f.max=e,S.textContent=`${x(e)}:${A(e)}`}()}));const D={en:{good:"Good",greeting:["night","morning","afternoon","evening"],timeOfDay:["night","morning","afternoon","evening"],placeholder:"enter your name"},ru:{good:["Доброй","Доброе","Добрый"],greeting:["ночи","утро","день","вечер"],timeOfDay:["ночь","утро","день","вечер"],placeholder:"введите свое имя"}};function T(e){return e[0].toUpperCase()+e.slice(1)}const j=document.querySelector(".time"),O=document.querySelector(".date");function N(){let e;return e=function(e,t){const n=D.en.timeOfDay;return e<6?n[0]:e<12?n[1]:e<18?n[2]:n[3]}((new Date).getHours()),e}function F(){const e=new Date,n=`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`;j.textContent=n,j.setAttribute("datetime",j.textContent),function(){const e=new Date,n=e.toLocaleDateString(`${t.language}-${T(t.language)}`,{weekday:"long",month:"long",day:"numeric"});O.textContent=T(n),O.setAttribute("datetime",e)}(),function(){H.setAttribute("placeholder",D[t.language].placeholder);const e=N();H.value.length?R.textContent=`${W(e)},`:R.textContent=`${W(e)}`}(),setTimeout(F,1e3)}const R=document.querySelector(".greeting"),H=document.querySelector(".name");function W(e){return"en"===t.language?`${D.en.good} ${e}`:"ru"===t.language?function(e){const t=D.ru.greeting,n=D.ru.good,o=D.en.timeOfDay;switch(e){case o[0]:return`${n[0]} ${t[0]}`;case o[1]:return`${n[1]} ${t[1]}`;case o[2]:return`${n[2]} ${t[2]}`;case o[3]:return`${n[2]} ${t[3]}`}}(e):void 0}function G(){H.value=H.value&&T(H.value);const e=Math.max(window.screen.width,window.innerWidth),n=H.value.length,o=t.name;var a,r;e>=670?(a=n,r=o,H.style.width=0===a&&""===r||0===a?"45%":`calc(8% + ${2.25*a}%)`):H.style.width="100%"}const J={en:{lang:"Language",bg:"Background image",placeholder:"Custom tag",display:"Display elements",error:"Error",errorRate:"Rate Limit Exceeded",notFound:"Nothing found",forbidden:"Missing permissions to perform request",items:{title:"Display items",time:"Time",date:"Date",greeting:"Greeting",quote:"Quote",weather:"Weather",audio:"Player",todolist:"To-Do List"}},ru:{lang:"Язык",bg:"Фоновое изображение",placeholder:"Свой тег",display:"Отобразить элементы",error:"Ошибка",errorRate:"Ограничение запросов превышено",notFound:"Ничего не найдено",forbidden:"Запрещено выполнение запроса",items:{title:"Отобразить элементы",time:"Время",date:"Дата",greeting:"Приветствие",quote:"Цитата",weather:"Погода",audio:"Плейер",todolist:"Список дел"}}},U=document.querySelector(".settings-button"),X=document.querySelector(".settings-popup"),Y=document.querySelector(".todo-popup"),B=document.querySelectorAll(".lang-button"),K=Object.values(document.querySelectorAll(".block-checkbox")),P=document.querySelectorAll(".bg-button"),V=document.querySelector(".options__span_type_lang"),Z=document.querySelector(".options__span_type_bg"),z=document.querySelector(".options__span_type_items"),ee=document.querySelector("#en"),te=document.querySelector("#ru"),ne=document.querySelector("#github"),oe=document.querySelector("#unsplash"),ae=document.querySelector("#flickr"),re=document.querySelector(".bg-query-input");function ue(e){"github"===e?re.classList.remove("bg-query-input_active"):re.classList.add("bg-query-input_active")}function ce(e){Array.from(P).forEach((t=>{t.getAttribute("value")!==e?t.removeAttribute("checked"):t.setAttribute("checked",!0)}))}function ie(e){Array.from(B).forEach((t=>{t.getAttribute("value")!==e?t.removeAttribute("checked"):t.setAttribute("checked",!0)}))}function le(e){const n=e.target.getAttribute("value");t.photoSource=n,ce(n),ue(n),ke()}function se(e){const n=e.target.getAttribute("value");t.language=n,ie(n),de()}function de(){V.textContent=`${J[t.language].lang}:`,Z.textContent=`${J[t.language].bg}:`,re.setAttribute("placeholder",`${J[t.language].placeholder}`),_e.textContent&&we(t.queryInputError),z.textContent=`${J[t.language].items.title}:`,e.forEach((e=>{document.querySelector(`.options__button_type_${e}`).textContent=J[t.language].items[e]}))}function ge(){K.forEach((e=>{const n=document.querySelector(`#${e.value}`);-1!==t.blocks.indexOf(e.value)?(e.setAttribute("checked","checked"),pe(n)):(e.removeAttribute("checked"),me(n))}))}function me(e){e.classList.add("page__item_disabled")}function pe(e){e.classList.remove("page__item_disabled")}function ye(e){const n=document.querySelector(`#${e.target.getAttribute("value")}`);"checked"===e.target.getAttribute("checked")?(t.blocks.splice(t.blocks.indexOf(e.target.getAttribute("value")),1),me(n)):(e.target.setAttribute("checked","checked"),t.blocks.push(e.target.getAttribute("value")),pe(n)),ge()}function he(e){e.classList.add("popup_active"),document.addEventListener("keydown",ve),document.addEventListener("mousedown",(e=>{e.target.classList.contains("popup_active")&&fe()}))}function fe(){document.querySelector(".popup_active").classList.remove("popup_active"),document.removeEventListener("keydown",ve)}function ve(e){"Escape"===e.key&&fe()}K.forEach((e=>{e.addEventListener("click",ye)})),ee.addEventListener("change",se),te.addEventListener("change",se),ne.addEventListener("change",le),oe.addEventListener("change",le),ae.addEventListener("change",le);const Se=document.querySelector(".body"),be=document.querySelector(".slide-prev"),qe=document.querySelector(".slide-next"),_e=document.querySelector(".bg-query-input__error");let Le;function we(e){_e.textContent=e?404==e?`${J[t.language].notFound}`:403==e?`${J[t.language].forbidden}`:"rate"===e?`${J[t.language].rate}`:`${J[t.language].error}: ${e}`:"",t.queryInputError=e}async function Ee(e,n){const o=new Image;we(),"unsplash"===t.photoSource?o.src=await async function(e){const n=((e,t)=>`https://api.unsplash.com/photos/random?orientation=landscape&query=${e||t}&client_id=vccpmfpxjX7plAMrKEXyVHlG-i6psZQy183H-Ge27p4`)(t.bgQuery,e),o=await fetch(n);try{return(await o.json()).urls.regular}catch{o.status?we(o.status):we("rate")}}(e):"flickr"===t.photoSource?o.src=await async function(e){const n=((e,t)=>`https://www.flickr.com/services/rest/?method=flickr.photos.search&api_key=12ec7ed5cce01fb906f9ef3032ecabcd&tags=${e||t}&extras=url_l&format=json&nojsoncallback=1`)(t.bgQuery,e),o=await fetch(n),a=await o.json(),r=a.photos.photo;try{return Le=Math.floor(Math.random()*(r.length-0+1))+0,a.photos.photo[Le].url_l}catch{!o.status&&we("rate"),0===r.length&&we(404)}}(e):o.src=`https://github.com/sergeyladorski/stage1-tasks/blob/assets/images/${e}/${n}.jpg?raw=true`,o.onload=()=>{Se.style.backgroundImage=`url(${o.src})`}}function ke(){Le=Math.floor(20*Math.random())+1,Ee(N(),Le.toString().padStart(2,"0"))}re.addEventListener("change",(function(){t.bgQuery=re.value,ke()})),be.addEventListener("click",(function(){1===Le?Le=20:Le--,Ee(N(),Le.toString().padStart(2,"0"))})),qe.addEventListener("click",(function(){20===Le?Le=1:Le++,Ee(N(),Le.toString().padStart(2,"0"))}));const $e={en:{wind:"Wind speed",speed:"m/s",humidity:"Humidity",emptyCityInput:"Empty city input",notFound:"City not found",placeholder:"enter city",defaultCity:"Minsk"},ru:{wind:"Скорость ветра",speed:"м/с",humidity:"Влажность воздуха",emptyCityInput:"Не задан город",notFound:"Город не найден",placeholder:"введите город",defaultCity:"Минск"}},Ce=document.querySelector(".city"),xe=document.querySelector(".weather-icon"),Ae=document.querySelector(".temperature"),Me=document.querySelector(".wind"),Ie=document.querySelector(".humidity"),Qe=document.querySelector(".weather-description"),De=document.querySelector(".weather-error");function Te(){Ae.textContent="",Qe.textContent="",Me.textContent="",Ie.textContent=""}async function je(){if(Ce.setAttribute("placeholder",$e[t.language].placeholder),"Minsk"===Ce.value||"Минск"===Ce.value?Ce.value=$e[t.language].defaultCity:Ce.value=Ce.value,xe.className="weather-icon owf",0===Ce.value.length)De.textContent=`${$e[t.language].emptyCityInput}`,Te();else{Ce.value=T(Ce.value);const e=`https://api.openweathermap.org/data/2.5/weather?q=${Ce.value}&lang=${t.language}&appid=352d4e7503e97f2906835b70fe7d7200&units=metric`,n=await fetch(e),o=await n.json();"404"===o.cod?(De.textContent=`${$e[t.language].notFound}`,Te()):(xe.classList.add(`owf-${o.weather[0].id}`),Ae.textContent=`${Math.round(o.main.temp)}°C`,Qe.textContent=o.weather[0].description,Me.textContent=`${$e[t.language].wind}: ${Math.round(o.wind.speed)}${$e[t.language].speed}`,Ie.textContent=`${$e[t.language].humidity}: ${Math.round(o.main.humidity)}%`,De.textContent="")}}const Oe={en:{title:"To-Do List",placeholder:"New Task",add:"Add"},ru:{title:"Список дел",placeholder:"Новое задание",add:"Добавить"}},Ne=document.querySelector(".todo-list__title"),Fe=document.querySelector(".todo-list__btn"),Re=document.querySelector(".todo-list__items"),He=document.querySelector(".todo-list__add"),We=document.querySelector(".todo-list__input");function Ge(){const e=We.value;if(""!==e){const t=document.createElement("li");t.classList.add("todo-list__item");const n=document.createTextNode(e),o=document.createElement("button");o.className="todo-list__delete-btn",t.append(n),t.append(o),Re.prepend(t),We.value="",document.querySelectorAll(".todo-list__delete-btn").forEach(((e,t)=>e.addEventListener("click",(e=>{e.target.parentNode.remove()}))))}}function Je(){je(),c(),Ne.textContent=Oe[t.language].title,We.setAttribute("placeholder",Oe[t.language].placeholder),He.textContent=Oe[t.language].add}d.addEventListener("click",(function(){q?(f.value=b.currentTime,b.pause()):E(),q=!q,d.classList.contains("pause")?d.classList.remove("pause"):d.classList.add("pause")})),g.addEventListener("click",(function(){f.value=0,0===_?_=l.length-1:_--,E(),k()})),m.addEventListener("click",C),a.addEventListener("click",i),c(),document.addEventListener("DOMContentLoaded",(function(){if(localStorage.getItem("settingsState")){const e=JSON.parse(localStorage.getItem("settingsState"));t.language=e.language,t.name=e.name,""!==e.city?t.city=e.city:t.city=$e[t.language].defaultCity,""!==e.bgQuery?t.bgQuery=e.bgQuery:t.bgQuery=N(),t.photoSource=e.photoSource}Ce.value=t.city,H.value=t.name,ie(t.language),ce(t.photoSource),ue(t.photoSource),re.value=t.bgQuery,F(),ke(),je(),G(),de()})),window.addEventListener("beforeunload",(function(){t.name=H.value,t.city=Ce.value,localStorage.setItem("settingsState",JSON.stringify(t))})),window.addEventListener("load",(function(){if(localStorage.getItem("settingsState")){const e=JSON.parse(localStorage.getItem("settingsState"));t.language=e.language,t.name=e.name,""!==e.city?t.city=e.city:t.city=$e[t.language].defaultCity,""!==e.bgQuery?t.bgQuery=e.bgQuery:t.bgQuery=N(),t.photoSource=e.photoSource,t.blocks=e.blocks}H.value=t.name,Ce.value=t.city,ie(t.language),ce(t.photoSource),ge(t.blocks)})),Ce.addEventListener("change",je),H.addEventListener("input",G),U.addEventListener("click",(()=>he(X))),ee.addEventListener("change",Je),te.addEventListener("change",Je),Fe.addEventListener("click",(()=>he(Y))),He.addEventListener("click",Ge),We.addEventListener("change",Ge),Re.addEventListener("click",(function(e){"LI"===e.target.tagName&&e.target.classList.toggle("todo-list__item_checked")}))})();